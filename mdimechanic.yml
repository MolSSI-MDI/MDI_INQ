code_name: 'INQ'
docker:
  image_name: 'mdi/inq'

  build_image:
    - apt-get update
    - apt-get install -y libblas-dev liblapack-dev libfftw3-dev git cmake pkg-config libboost-all-dev

  build_engine:
    # Obtain a clone of INQ
    - |
      if [ ! -d "build/inq" ]; then
        git clone --branch mdi --recurse-submodules https://gitlab.com/taylor-a-barnes/inq.git build/inq
      fi
    - cd build/inq
    - mkdir -p build
    - cd build
    # Only configure once, because it is a long process
    - |
      if [ ! -d "../../install" ]; then
        ../configure --prefix=/repo/build/install
      fi
    - make
    - make install

  validate_engine:
    - cd build/inq/build/tests
    - ./h2o_ground_state


engine_tests:
  # Provide at least one example input that can be used to test your code's MDI functionality
  script:
    - cd build/inq/build/examples
    - ./inq_mdi -mdi "${MDI_OPTIONS}"


test_drivers:
  test_driver:
    script:
      - cd tests/driver
      - python driver.py -mdi "-role DRIVER -name driver -method TCP -port 8021"
